<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ­ÙƒÙ… Ø³ÙŠØ§Ø±Ø© Ø¨Ù„ÙˆØªÙˆØ« - Arduino</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            padding: 10px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 100, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(100, 0, 0, 0.1) 0%, transparent 20%);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #00ff00;
            background: linear-gradient(90deg, #001100, #003300);
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .header h1 {
            font-size: 1.6rem;
            color: #00ff00;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .header p {
            color: #88ff88;
            font-size: 0.9rem;
        }

        .status-bar {
            background: #111111;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .status-item {
            text-align: center;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .status-label {
            color: #888888;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.1rem;
            font-weight: bold;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-value.connected { color: #00ff00; }
        .status-value.disconnected { color: #ff0000; }
        .status-value.fire { color: #ff5500; }
        .status-value.safe { color: #00ff00; }

        .controls {
            background: #111111;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .section-title {
            color: #00ff00;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.3);
        }

        .joystick {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            width: 75px;
            height: 75px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(145deg, #222222, #1a1a1a);
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            box-shadow: 
                5px 5px 10px #0a0a0a,
                -5px -5px 10px #282828;
            position: relative;
            overflow: hidden;
        }

        .control-btn:active {
            transform: scale(0.92);
            box-shadow: 
                2px 2px 5px #0a0a0a inset,
                -2px -2px 5px #282828 inset;
        }

        .control-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .center-btn {
            background: linear-gradient(145deg, #ff5500, #cc4400);
            box-shadow: 
                5px 5px 10px #0a0a0a,
                -5px -5px 10px #282828;
        }

        .center-btn:active {
            background: linear-gradient(145deg, #cc4400, #aa3300);
        }

        .fire-control {
            background: #111111;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .fire-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .fire-btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(145deg, #ff3300, #cc2200);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 5px 15px rgba(255, 51, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .fire-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: linear-gradient(145deg, #cc2200, #aa1100);
        }

        .fire-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .fire-btn.stop {
            background: linear-gradient(145deg, #666666, #444444);
            box-shadow: 0 5px 15px rgba(102, 102, 102, 0.3);
        }

        .fire-btn.stop:active:not(:disabled) {
            background: linear-gradient(145deg, #444444, #222222);
        }

        .sensor-data {
            background: #111111;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .sensor-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            text-align: center;
        }

        .sensor-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .sensor-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffffff;
            margin: 10px 0;
            text-shadow: 0 0 10px currentColor;
        }

        .sensor-label {
            font-size: 0.9rem;
            color: #888888;
        }

        .flame-bar {
            width: 100%;
            height: 20px;
            background: #222222;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #333;
            position: relative;
        }

        .flame-level {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff5500, #ff0000);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .connection-panel {
            background: #111111;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .connection-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff0000;
            animation: none;
        }

        .connection-dot.connected {
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .bluetooth-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .bluetooth-btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(145deg, #0066cc, #004499);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .bluetooth-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: linear-gradient(145deg, #004499, #002266);
        }

        .bluetooth-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .bluetooth-btn.disconnect {
            background: linear-gradient(145deg, #cc0000, #990000);
            box-shadow: 0 5px 15px rgba(204, 0, 0, 0.3);
        }

        .device-list {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            background: #1a1a1a;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #333;
        }

        .device-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #222222;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #333;
        }

        .device-item:active {
            background: #333333;
            transform: scale(0.98);
        }

        .device-item:hover {
            border-color: #00ff00;
        }

        .device-name {
            color: #ffffff;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .device-id {
            color: #888888;
            font-size: 0.8rem;
            font-family: monospace;
        }

        .logs {
            background: #111111;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #222222;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .log-box {
            background: #000000;
            border-radius: 10px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
            border: 1px solid #333;
            direction: ltr;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #222;
            color: #cccccc;
        }

        .log-time {
            color: #888888;
            float: right;
            margin-left: 10px;
            font-size: 0.8rem;
        }

        .log-entry.info { color: #00aaff; }
        .log-entry.success { color: #00ff00; }
        .log-entry.error { color: #ff0000; }
        .log-entry.warning { color: #ffff00; }
        .log-entry.bluetooth { color: #ff00ff; }

        footer {
            text-align: center;
            padding: 20px 0;
            color: #666666;
            font-size: 0.8rem;
            border-top: 1px solid #222;
            margin-top: 10px;
        }

        .instructions {
            background: rgba(0, 100, 0, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #00ff00;
        }

        .instructions h4 {
            color: #00ff00;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .instructions ul {
            padding-right: 20px;
            color: #88ff88;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #222222;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #88ff88;
        }

        @media (max-width: 380px) {
            .control-btn {
                width: 65px;
                height: 65px;
                font-size: 1.6rem;
            }
            
            .sensor-value {
                font-size: 1.5rem;
            }
            
            .bluetooth-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <p>Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬ - Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</div>
                <div class="status-value disconnected" id="connection-text">ØºÙŠØ± Ù…ØªØµÙ„</div>
            </div>
            <div class="status-item">
                <div class="status-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙŠÙ‚</div>
                <div class="status-value safe" id="fire-status">Ø¢Ù…Ù†</div>
            </div>
            <div class="status-item">
                <div class="status-label">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø³Ø§Ø³</div>
                <div class="status-value" id="sensor-value">---</div>
            </div>
        </div>

        <div class="controls">
            <h2 class="section-title">ğŸ® Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div class="joystick">
                <div class="row">
                    <button class="control-btn" id="forward-btn" data-command="F">â†‘</button>
                </div>
                <div class="row">
                    <button class="control-btn" id="left-btn" data-command="L">â†</button>
                    <button class="control-btn center-btn" id="stop-btn" data-command="S">â¹</button>
                    <button class="control-btn" id="right-btn" data-command="R">â†’</button>
                </div>
                <div class="row">
                    <button class="control-btn" id="backward-btn" data-command="B">â†“</button>
                </div>
            </div>
        </div>

        <div class="fire-control">
            <h2 class="section-title">ğŸ§¯ Ù†Ø¸Ø§Ù… Ø¥Ø·ÙØ§Ø¡ Ø§Ù„Ø­Ø±Ø§Ø¦Ù‚</h2>
            <div class="fire-btns">
                <button class="fire-btn" id="pump-on-btn">
                    <span>ğŸ”¥</span> ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¶Ø®Ø©
                </button>
                <button class="fire-btn stop" id="pump-off-btn">
                    <span>â¹</span> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¶Ø®Ø©
                </button>
            </div>
        </div>

        <div class="sensor-data">
            <h2 class="section-title">ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³ Ø§Ù„Ù„Ù‡Ø¨</h2>
            <div class="sensor-display">
                <div class="sensor-item">
                    <div class="sensor-label">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                    <div class="sensor-value" id="current-value">0</div>
                    <div class="flame-bar">
                        <div class="flame-level" id="flame-level"></div>
                    </div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-label">Ø¹ØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠÙ‚</div>
                    <div class="sensor-value" style="color: #ff5500;">500</div>
                    <div class="instructions" style="margin-top: 10px; font-size: 0.8rem;">
                        Ø£Ù‚Ù„ Ù…Ù† 500 = Ø­Ø±ÙŠÙ‚
                    </div>
                </div>
            </div>
        </div>

        <div class="connection-panel">
            <h2 class="section-title">ğŸ“¡ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«</h2>
            <div class="connection-status">
                <div class="connection-dot" id="connection-dot"></div>
                <span id="connection-status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„</span>
            </div>
            
            <div class="bluetooth-buttons">
                <button class="bluetooth-btn" id="scan-btn">
                    <span>ğŸ”</span> Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø©
                </button>
                <button class="bluetooth-btn disconnect" id="disconnect-btn" style="display: none;">
                    <span>âŒ</span> Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
                </button>
            </div>

            <div class="device-list" id="device-list">
                <div class="device-item" style="text-align: center; color: #888;">
                    Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©
                </div>
            </div>
            
            <div class="instructions">
                <h4>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„:</h4>
                <ul>
                    <li>1. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ« Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ù€ HC-05</li>
                    <li>2. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø©"</li>
                    <li>3. Ø§Ø®ØªØ± HC-05 Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 1234)</li>
                    <li>4. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ù„Ø§ØªØµØ§Ù„</li>
                    <li>5. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„</li>
                </ul>
            </div>
        </div>

        <div class="logs">
            <h2 class="section-title">ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
            <div class="log-box" id="log-box">
                <div class="log-entry info">ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ <span class="log-time">10:30:15</span></div>
                <div class="log-entry info">ğŸ“± Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø© <span class="log-time">10:30:20</span></div>
            </div>
        </div>

        <footer>
            <p>Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬ - Ù†Ø¸Ø§Ù… Ø³ÙŠØ§Ø±Ø© Ø°ÙƒÙŠØ© Ù…Ø¹ Ø¥Ø·ÙØ§Ø¡ Ø­Ø±Ø§Ø¦Ù‚</p>
            <p>Arduino Uno + HC-05 + L298N + IR Flame Sensor</p>
        </footer>
    </div>

    <script>
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const appState = {
            connected: false,
            fireDetected: false,
            sprinklerActive: false,
            flameValue: 0,
            fireThreshold: 500,
            device: null,
            characteristic: null,
            server: null,
            devices: []
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const connectionText = document.getElementById('connection-text');
        const fireStatus = document.getElementById('fire-status');
        const sensorValue = document.getElementById('sensor-value');
        const currentValue = document.getElementById('current-value');
        const flameLevel = document.getElementById('flame-level');
        const connectionDot = document.getElementById('connection-dot');
        const connectionStatus = document.getElementById('connection-status');
        const scanBtn = document.getElementById('scan-btn');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const deviceList = document.getElementById('device-list');
        const logBox = document.getElementById('log-box');
        
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
        const forwardBtn = document.getElementById('forward-btn');
        const backwardBtn = document.getElementById('backward-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const stopBtn = document.getElementById('stop-btn');
        const pumpOnBtn = document.getElementById('pump-on-btn');
        const pumpOffBtn = document.getElementById('pump-off-btn');

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ar-EG', {hour12: false});
        }

        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `${message} <span class="log-time">${getCurrentTime()}</span>`;
            
            logBox.appendChild(logEntry);
            logBox.scrollTop = logBox.scrollHeight;
            
            // Ø­ÙØ¸ ÙÙ‚Ø· Ø¢Ø®Ø± 20 Ø³Ø¬Ù„
            const logs = logBox.querySelectorAll('.log-entry');
            if (logs.length > 20) {
                logs[0].remove();
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI() {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            connectionText.textContent = appState.connected ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„';
            connectionText.className = `status-value ${appState.connected ? 'connected' : 'disconnected'}`;
            
            connectionStatus.textContent = appState.connected ? 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©' : 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„';
            connectionDot.className = `connection-dot ${appState.connected ? 'connected' : ''}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙŠÙ‚
            const isFire = appState.flameValue < appState.fireThreshold;
            appState.fireDetected = isFire;
            
            fireStatus.textContent = isFire ? 'ğŸ”¥ Ø­Ø±ÙŠÙ‚' : 'Ø¢Ù…Ù†';
            fireStatus.className = `status-value ${isFire ? 'fire' : 'safe'}`;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³
            sensorValue.textContent = appState.flameValue;
            currentValue.textContent = appState.flameValue;
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù„Ù‡Ø¨
            const flamePercent = Math.min(100, Math.max(0, (appState.flameValue / 1023) * 100));
            flameLevel.style.width = `${flamePercent}%`;
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„Ù„Ù‡Ø¨
            if (appState.flameValue < appState.fireThreshold) {
                flameLevel.style.background = 'linear-gradient(90deg, #ff0000, #ff5500)';
            } else if (appState.flameValue < 700) {
                flameLevel.style.background = 'linear-gradient(90deg, #ff5500, #ffff00)';
            } else {
                flameLevel.style.background = 'linear-gradient(90deg, #ffff00, #00ff00)';
            }
            
            // ØªÙ…ÙƒÙŠÙ†/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            const controlBtns = [forwardBtn, backwardBtn, leftBtn, rightBtn, stopBtn, pumpOnBtn, pumpOffBtn];
            controlBtns.forEach(btn => {
                btn.disabled = !appState.connected;
            });
            
            // ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø­Ø±ÙŠÙ‚
            if (appState.fireDetected) {
                [forwardBtn, backwardBtn, leftBtn, rightBtn].forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
            if (appState.connected) {
                scanBtn.style.display = 'none';
                disconnectBtn.style.display = 'block';
            } else {
                scanBtn.style.display = 'block';
                disconnectBtn.style.display = 'none';
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«
        async function sendBluetoothCommand(command) {
            if (!appState.connected || !appState.characteristic) {
                addLog('ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'error');
                return false;
            }
            
            try {
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø¨Ø§ÙŠØªØ§Øª
                const encoder = new TextEncoder();
                const data = encoder.encode(command);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await appState.characteristic.writeValue(data);
                addLog(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±: ${command}`, 'bluetooth');
                console.log(`ğŸ“¤ Sent to Arduino: ${command}`);
                return true;
            } catch (error) {
                addLog(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±: ${error.message}`, 'error');
                console.error('Bluetooth send error:', error);
                return false;
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø© Ø¨Ù„ÙˆØªÙˆØ« - Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¶Ù…ÙˆÙ†Ø©
        async function discoverBluetoothDevices() {
            try {
                addLog('ğŸ” Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«...', 'info');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Web Bluetooth API
                if (!navigator.bluetooth) {
                    throw new Error('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Web Bluetooth API. Ø§Ø³ØªØ®Ø¯Ù… Chrome Ø¹Ù„Ù‰ Android Ø£Ùˆ Edge Ø¹Ù„Ù‰ Windows 10+');
                }
                
                // Ø·Ø±ÙŠÙ‚Ø© 1: Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ± Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø¬Ø§Ø­Ø§Ù‹)
                const device = await navigator.bluetooth.requestDevice({
                    // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… filters Ù„Ø£Ù†Ù‡Ø§ Ù‚Ø¯ ØªØ³Ø¨Ø¨ Ù…Ø´Ø§ÙƒÙ„
                    acceptAllDevices: true,
                    optionalServices: ['00001101-0000-1000-8000-00805f9b34fb'] // SPP UUID
                });
                
                if (!device) {
                    addLog('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¬Ù‡Ø§Ø²', 'warning');
                    return;
                }
                
                addLog(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: ${device.name || 'Ø¬Ù‡Ø§Ø² Ø¨Ù„ÙˆØªÙˆØ«'}`, 'success');
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø²
                await connectToBluetoothDevice(device);
                
            } catch (error) {
                console.error('Bluetooth discovery error:', error);
                
                if (error.name === 'NotFoundError') {
                    addLog('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ø¨Ù„ÙˆØªÙˆØ« Ù‚Ø±ÙŠØ¨Ø©', 'error');
                    addLog('ØªØ£ÙƒØ¯ Ù…Ù†: 1) ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ« Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ 2) ØªØ´ØºÙŠÙ„ HC-05 3) Ø£Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ù† (LED ÙŠØ±Ù…Ø´)', 'warning');
                } else if (error.name === 'SecurityError') {
                    addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«', 'error');
                } else if (error.name === 'NetworkError') {
                    addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«', 'error');
                } else if (error.message.includes('Ø¯Ø¹Ù…')) {
                    addLog('âŒ ' + error.message, 'error');
                    scanBtn.disabled = true;
                    scanBtn.innerHTML = 'âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
                } else {
                    addLog(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                }
                
                updateUI();
            }
        }

        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¬Ù‡Ø§Ø² Ø¨Ù„ÙˆØªÙˆØ«
        async function connectToBluetoothDevice(device) {
            try {
                addLog('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø²...', 'info');
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„
                device.addEventListener('gattserverdisconnected', () => {
                    addLog('âš ï¸ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø²', 'error');
                    appState.connected = false;
                    appState.device = null;
                    appState.characteristic = null;
                    updateUI();
                });
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… GATT
                const server = await device.gatt.connect();
                appState.server = server;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© (Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ù„Ù€ HC-05)
                // Ù†Ø³ØªØ®Ø¯Ù… Ø¹Ø¯Ø© UUIDs Ø´Ø§Ø¦Ø¹Ø© Ù„Ù„ØªÙˆØ§ÙÙ‚
                const serviceUUIDs = [
                    '00001101-0000-1000-8000-00805f9b34fb', // SPP
                    '00001101-0000-1000-8000-00805f9b34fa', // SPP alternative
                    '0000ffe0-0000-1000-8000-00805f9b34fb'  // Common for HC-05
                ];
                
                let service = null;
                for (const uuid of serviceUUIDs) {
                    try {
                        service = await server.getPrimaryService(uuid);
                        console.log(`âœ… Connected to service: ${uuid}`);
                        break;
                    } catch (e) {
                        console.log(`âŒ Failed to get service ${uuid}:`, e.message);
                    }
                }
                
                if (!service) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©');
                }
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®Ø§ØµÙŠØ© Ø§Ù„ÙƒØªØ§Ø¨Ø©
                const characteristicUUIDs = [
                    '00001101-0000-1000-8000-00805f9b34fb',
                    '0000ffe1-0000-1000-8000-00805f9b34fb'
                ];
                
                for (const uuid of characteristicUUIDs) {
                    try {
                        appState.characteristic = await service.getCharacteristic(uuid);
                        console.log(`âœ… Got characteristic: ${uuid}`);
                        break;
                    } catch (e) {
                        console.log(`âŒ Failed to get characteristic ${uuid}:`, e.message);
                    }
                }
                
                if (!appState.characteristic) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø®Ø§ØµÙŠØ© Ø§Ù„ÙƒØªØ§Ø¨Ø©');
                }
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù†Ø§Ø¬Ø­
                appState.connected = true;
                appState.device = device;
                addLog('ğŸ‰ ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± ØªÙˆÙ‚Ù Ø£ÙˆÙ„ÙŠ
                await sendBluetoothCommand('S');
                
                updateUI();
                
            } catch (error) {
                console.error('Connection error:', error);
                addLog(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
                appState.connected = false;
                updateUI();
            }
        }

        // Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
        async function disconnectBluetooth() {
            try {
                if (appState.device && appState.device.gatt.connected) {
                    // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± ØªÙˆÙ‚Ù Ø£ÙˆÙ„Ø§Ù‹
                    await sendBluetoothCommand('S');
                    appState.device.gatt.disconnect();
                }
            } catch (error) {
                console.error('Disconnect error:', error);
            } finally {
                appState.connected = false;
                appState.device = null;
                appState.characteristic = null;
                appState.server = null;
                addLog('ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„', 'info');
                updateUI();
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³
        function simulateSensorData() {
            if (!appState.connected) return;
            
            // ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø³Ø§Ø³
            const change = (Math.random() - 0.5) * 60;
            appState.flameValue = Math.max(0, Math.min(1023, appState.flameValue + change));
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ÙƒØªØ´Ø§Ù Ø­Ø±ÙŠÙ‚ (10% ÙØ±ØµØ©)
            if (Math.random() < 0.1 && !appState.fireDetected) {
                appState.flameValue = Math.floor(Math.random() * 400);
                addLog('ğŸ”¥ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø­Ø±ÙŠÙ‚! Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØªØªÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹', 'warning');
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± ØªÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                sendBluetoothCommand('S');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨Ø¹Ø¯ 8 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => {
                    if (appState.flameValue < 500) {
                        appState.flameValue = 800 + Math.floor(Math.random() * 200);
                    }
                }, 8000);
            }
            
            updateUI();
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø©
            scanBtn.addEventListener('click', discoverBluetoothDevices);
            
            // Ø²Ø± Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
            disconnectBtn.addEventListener('click', disconnectBluetooth);
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
            forwardBtn.addEventListener('click', async () => {
                if (!appState.connected || appState.fireDetected) return;
                await sendBluetoothCommand('F');
            });
            
            backwardBtn.addEventListener('click', async () => {
                if (!appState.connected || appState.fireDetected) return;
                await sendBluetoothCommand('B');
            });
            
            leftBtn.addEventListener('click', async () => {
                if (!appState.connected || appState.fireDetected) return;
                await sendBluetoothCommand('L');
            });
            
            rightBtn.addEventListener('click', async () => {
                if (!appState.connected || appState.fireDetected) return;
                await sendBluetoothCommand('R');
            });
            
            stopBtn.addEventListener('click', async () => {
                if (!appState.connected) return;
                await sendBluetoothCommand('S');
            });
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¶Ø®Ø©
            pumpOnBtn.addEventListener('click', async () => {
                if (!appState.connected) return;
                // ÙÙŠ Ù†Ø¸Ø§Ù…ÙƒØŒ Ø§Ù„Ù…Ø¶Ø®Ø© ØªØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø­Ø±ÙŠÙ‚
                // ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø®Ø§Øµ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
                addLog('Ø§Ù„Ù…Ø¶Ø®Ø© ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø­Ø±ÙŠÙ‚', 'info');
            });
            
            pumpOffBtn.addEventListener('click', async () => {
                if (!appState.connected) return;
                addLog('Ø§Ù„Ù…Ø¶Ø®Ø© ØªØªÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø­Ø±ÙŠÙ‚', 'info');
            });
            
            // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', async (e) => {
                if (!appState.connected || appState.fireDetected) return;
                
                switch(e.key.toLowerCase()) {
                    case 'arrowup':
                    case 'w':
                        forwardBtn.click();
                        break;
                    case 'arrowdown':
                    case 's':
                        backwardBtn.click();
                        break;
                    case 'arrowleft':
                    case 'a':
                        leftBtn.click();
                        break;
                    case 'arrowright':
                    case 'd':
                        rightBtn.click();
                        break;
                    case ' ':
                    case 'x':
                        stopBtn.click();
                        break;
                }
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function init() {
            addLog('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ©', 'success');
            addLog('ğŸ“± Ø§Ø¶ØºØ· "Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¬Ù‡Ø²Ø©" Ù„Ù„Ø§ØªØµØ§Ù„', 'info');
            
            setupEventListeners();
            updateUI();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³ ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©
            setInterval(simulateSensorData, 2000);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«
            if (!navigator.bluetooth) {
                addLog('âŒ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Web Bluetooth API', 'error');
                addLog('ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Chrome Ø¹Ù„Ù‰ Android Ø£Ùˆ Edge Ø¹Ù„Ù‰ Windows 10+', 'warning');
                scanBtn.disabled = true;
                scanBtn.innerHTML = 'âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
